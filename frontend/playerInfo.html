<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
	<link rel="stylesheet" type="text/css" href="css/main.css" />
	<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
	<title>Игроки</title>
	<meta http-equiv="X-UA-Compatible" content="IE=8;charset=utf-8">
</head>
<body>
    <input type="button" name="login" value="Назад" onClick="toPlayersPage()" style="float: left;">
	<input type="button" name="login" value="Войти" onClick="toLoginPage()" style="float: right;">
	<br>

    <h1 id="playerId" style="text-align: center">Игрок 98273723</h1>
    <b>Никнеймы:</b>
    <p id="nicknames">
        names
    </p>
    <br>

    <p><b>Убийств: </b><div id="kills">kills</div></p><br>
    <p><b>Убийств/Смертей: </b><div id="kd">kd</div></p><br>
    <p><b>Артефактов: </b><div id="arts">arts</div></p><br>
    <p><b>Часов в игре: </b><div id="hoursIngame">hoursIngame</div></p><br>
    <p><b>Любимое оружие: </b><div id="bestWpn">bestWpn</div></p><br>

    <input type="button" value="Сохранить в PDF" onClick="getPdf()" style="float: left;">

    <h1 style="text-align: center">Игры</h1>

<script language="javascript" type="text/javascript">

const urlParams = new URLSearchParams(window.location.search);
id = urlParams.get("player");

var Load = function()
{
	if (id == null) 
	{
		toPlayersPage();
	}

	req = "http://194.147.90.72:8080/StatsSite/v1/GetPlayer?player="+id;
	M = httpGet(req)
	
	//PrintS(M.responseText)	
	//PrintS(M.);

	var J = JSON.parse(M.responseText);
	
	//PrintJSON("res",J);
	CreatePlayerStat(J);
    CreateGamesList(J.games)
}

function CreatePlayerStat(player) 
{
    document.getElementById('playerId').innerHTML = "Игрок " + id;
    document.getElementById('nicknames').innerHTML = player.nicknames;
    document.getElementById('kills').innerHTML = player.frags;
    document.getElementById('kd').innerHTML = player.kd;
    document.getElementById('hoursIngame').innerHTML = player.hoursIngame;
    document.getElementById('bestWpn').innerHTML = player.favouriteWeapon;
}

function CreateGamesList(games)
{
	const body = document.body, tbl = document.createElement('table');

	tbl.style.width = '100%';
	tbl.style.border = '1px solid black';
	tbl.style.borderCollapse = "collapse";

	const tr1 = tbl.insertRow();
	const td1 = tr1.insertCell();

	text = "Сервер";
	td1.appendChild(document.createTextNode(text));
	td1.style.border = '1px solid black';
	td1.style.borderCollapse = "collapse";
	td1.style.padding = '10px'
    td1.style.width="33%";

	td2 = tr1.insertCell();
	text = "Карта"
	td2.style.border = '1px solid black';
	td2.style.borderCollapse = "collapse";
    td2.style.width="33%";
	td2.appendChild(document.createTextNode(text));

	td3 = tr1.insertCell();
	td3.style.border = '1px solid black';
	td3.style.borderCollapse = "collapse";
    td3.style.width="33%";
	td3.appendChild(document.createTextNode("Дата"));

	for (let i = 0; i < games.length; i++) 
	{
		const tr = tbl.insertRow();
		const td = tr.insertCell();

		tr.onclick = ()=>OnGameClick(games[i].id);
		td.style.border = '1px solid black';
		td.style.borderCollapse = "collapse";
		td.style.padding = '10px'

		td.appendChild(document.createTextNode(games[i].serverName));

		td2 = tr.insertCell();
		td2.style.border = '1px solid black';
		td2.style.borderCollapse = "collapse";
		td2.appendChild(document.createTextNode(games[i].mapName));

		td3 = tr.insertCell();
		td3.style.border = '1px solid black';
		td3.style.borderCollapse = "collapse";
		td3.appendChild(document.createTextNode(games[i].date));
	}

	body.appendChild(tbl);
}

function getPdf()
{
    window.open("http://194.147.90.72:8080/StatsSite/v1/GetPlayerPdf?player="+id, '_blank').focus();
} 

function OnGameClick(gameId)
{
	toGamePage(gameId);
}

function toGamePage(gameId)
{
	location = "game.html?game="+gameId+"&player="+id;
	throw new Error();
}

function toPlayersPage()
{
	location = "players.html";
	throw new Error();
}

function httpGet(theUrl)
{
    var xmlHttp = new XMLHttpRequest({mozSystem: true});
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
	//xmlHttp.setRequestHeader('Content-Type', 'application/json');
	//xmlHttp.getResponseHeader('Content-Type', 'application/json');
	//xmlHttp.responseType = 'json';
    xmlHttp.send();	
    return xmlHttp;
}

function toPlayerInfo(player)
{	
	location = "playerInfo.html?player="+player;
	throw new Error();
}

function toLoginPage()
{
	loginPage = "login.html"
	location = loginPage;
	throw new Error();
}

function PrintS(s) { document.body.innerHTML += s; }
function PrintP(p) { document.body.innerHTML += "\<img src=\"data:image\/png;base64," + p + "\"\/\>";}
function PrintTIME(s,t1) { PrintS("<b><i>" + s + ": "+ (new Date().getTime()-t1.getTime())/1000 +"</i></b> sec.<br>") }
function PrintJSON (str,obj) { PrintS( str + ":<p>"      + unescape(JSON.stringify(obj).replace(/\\u/g, '%u').replace(/</g,"&lt;").replace(/>/g,"&gt;"))); }
function PrintJSONb(str,obj) { PrintS( str + ":<p><pre>" + unescape(JSON.stringify(obj,null,4).replace(/\\u/g, '%u').replace(/</g,"&lt;").replace(/>/g,"&gt;")) + "</pre>" ); }
function PrintXML(str,obj) { PrintS( str + ":<p>" + obj.replace(/</g,"&lt;").replace(/>/g,"&gt;") + "<br>" ); }

Load();

</script>
</body></html>
